(this["webpackJsonpxagon-react-app"]=this["webpackJsonpxagon-react-app"]||[]).push([[0],{245:function(e,t,n){},252:function(e,t,n){"use strict";n.r(t);var i,r,a,o=n(35),s=n.n(o),c=n(238),l=n.n(c),u=(n(245),n(239)),h=n(47),g=n(183),d=n.n(g),f=n(223),v=n(15),p="TriangleMesh",b=n(59),m=n(88),M=n(153),T=n(152),y=1e-8,k=function e(){Object(b.a)(this,e)},j=n(115);!function(e){e[e.First=0]="First",e[e.Second=1]="Second",e[e.Third=2]="Third"}(r||(r={})),function(e){e[e.First=0]="First",e[e.Second=1]="Second",e[e.Third=2]="Third",e[e.Fourth=3]="Fourth",e[e.Fifth=4]="Fifth",e[e.Sixth=5]="Sixth"}(a||(a={}));var V=(i={},Object(j.a)(i,a.First,v.Color3.Blue()),Object(j.a)(i,a.Second,v.Color3.Red()),Object(j.a)(i,a.Third,v.Color3.Yellow()),Object(j.a)(i,a.Fourth,v.Color3.Green()),Object(j.a)(i,a.Fifth,v.Color3.Purple()),Object(j.a)(i,a.Sixth,v.Color3.Gray()),i),w=.5*Object.keys(a).length,x=function(){function e(t,n,i,r){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:e.getRandomType();Object(b.a)(this,e),this.vertices=void 0,this.triangleId=void 0,this.adjacents=[],this.type=a.First,this.triangleId=t,this.vertices=[n,i,r],this.type=o}return Object(m.a)(e,[{key:"getType",value:function(){return this.type}},{key:"setType",value:function(e){this.type=e}},{key:"getColor",value:function(){return V[this.type]}},{key:"getId",value:function(){return this.triangleId}},{key:"getName",value:function(){return"Triangle".concat(this.getId())}},{key:"p1",value:function(){return this.vertices[0]}},{key:"p2",value:function(){return this.vertices[1]}},{key:"p3",value:function(){return this.vertices[2]}},{key:"getVertices",value:function(){return this.vertices}},{key:"getCenterPoint",value:function(){var e=v.Vector3.Center(this.vertices[0],this.vertices[1]),t=this.vertices[2].add(e.subtract(this.vertices[2]).scale(2/3)),n=v.Vector3.Center(this.vertices[1],this.vertices[2]),i=this.vertices[0].add(n.subtract(this.vertices[0]).scale(2/3)),r=v.Vector3.Center(this.vertices[2],this.vertices[0]),a=this.vertices[1].add(r.subtract(this.vertices[1]).scale(2/3)),o=v.Vector3.Center(i,a);return t.add(o.subtract(t).scale(2/3))}},{key:"getAdjacents",value:function(){return this.adjacents}},{key:"setAdjacent",value:function(e,t){this.adjacents[t]=e}},{key:"pushAdjacent",value:function(e){console.assert(this.adjacents.length<=3,"FATAL ERROR!!!"),this.adjacents.find((function(t){return(null===t||void 0===t?void 0:t.getId())===e.getId()}))||this.adjacents.push(e)}},{key:"isAdjacent",value:function(e){var t=this.adjacents.find((function(t){return(null===t||void 0===t?void 0:t.getId())===e.getId()}));return!!t}}],[{key:"getTypesCount",value:function(){return w}},{key:"getRandomType",value:function(){return Math.floor(Math.random()*e.getTypesCount())}}]),e}(),I=x,O=function(e){Object(M.a)(n,e);var t=Object(T.a)(n);function n(e){var i;return Object(b.a)(this,n),(i=t.call(this)).triangles=void 0,i.triangleCount=0n,i.subdivisionStrategy=void 0,i.onTrianglesChanged=function(){},i.subdivisionStrategy=e.subdivisionStrategy,e.triangles?i.triangles=e.triangles:(i.triangles=i.computeRegularIcosahedronTriangles(),R(i.triangles)),i}return Object(m.a)(n,[{key:"genTriangleId",value:function(){return this.triangleCount+=1n,this.triangleCount}},{key:"makeTriangle",value:function(e,t,n){return new I(this.genTriangleId(),e,t,n)}},{key:"computeRegularIcosahedronTriangles",value:function(){var e=this,t=1/(.5*(1+Math.sqrt(5))),n=[new v.Vector3(0,t,-1),new v.Vector3(t,1,0),new v.Vector3(-t,1,0),new v.Vector3(0,t,1),new v.Vector3(0,-t,1),new v.Vector3(-1,0,t),new v.Vector3(0,-t,-1),new v.Vector3(1,0,-t),new v.Vector3(1,0,t),new v.Vector3(-1,0,-t),new v.Vector3(t,-1,0),new v.Vector3(-t,-1,0)].map(v.Vector3.Normalize);return[[0,1,2],[3,2,1],[3,4,5],[3,8,4],[0,6,7],[0,9,6],[4,10,11],[6,11,10],[2,5,9],[11,9,5],[1,7,8],[10,8,7],[3,5,2],[3,1,8],[0,2,9],[0,7,1],[6,9,11],[6,10,7],[4,11,5],[4,8,10]].map((function(t){return new I(e.genTriangleId(),n[t[0]],n[t[1]],n[t[2]])}))}},{key:"getTriangles",value:function(){return this.triangles}},{key:"subdivide",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=0;t<e;t+=1)this.triangles=this.subdivisionStrategy.subdivide(this);R(this.triangles)}},{key:"registerOnTriangleChanged",value:function(e){this.onTrianglesChanged=e}},{key:"notifyTrianglesChanged",value:function(e){this.onTrianglesChanged(e)}},{key:"findEquilateralTriangle",value:function(){var e=this.triangles.find((function(e){var t=e.p1().subtract(e.p2()).length().toFixed(8),n=e.p2().subtract(e.p3()).length().toFixed(8),i=e.p3().subtract(e.p1()).length().toFixed(8);return t===n&&n===i}));return e||console.warn("Equilateral Triangle not found"),e||this.triangles[0]}}]),n}(k);function R(e){var t=function(e,t){return e.getVertices().findIndex((function(e){return Math.abs(t.subtract(e).length())<y}))};e.forEach((function(n){e.forEach((function(e){if(n.getId()!==e.getId()){var i=[t(n,e.p1()),t(n,e.p2()),t(n,e.p3())].filter((function(e){return-1!==e}));if(2===i.length){var r=i[0]+i[1];1===r&&n.setAdjacent(e,0),3===r&&n.setAdjacent(e,1),2===r&&n.setAdjacent(e,2)}}}))}))}var N,S=O,P=n(161),E=function(){function e(){Object(b.a)(this,e)}return Object(m.a)(e,[{key:"subdivide",value:function(e){return e.getTriangles().reduce((function(t,n){return[].concat(Object(P.a)(t),Object(P.a)(C(n,e)))}),[])}}]),e}(),C=function(e,t){var n=v.Vector3.Center(e.p2(),e.p1()),i=v.Vector3.Center(e.p3(),e.p2()),r=v.Vector3.Center(e.p1(),e.p3()),a=n.scale(1/n.length()),o=i.scale(1/i.length()),s=r.scale(1/r.length()),c=[t.makeTriangle(e.p1(),a,s),t.makeTriangle(a,e.p2(),o),t.makeTriangle(a,o,s),t.makeTriangle(s,o,e.p3())];return c.forEach((function(e){return e.setType(I.getRandomType())})),c},A={angle90:.5*Math.PI,angle120:Math.PI*(2/3)},B=function e(){Object(b.a)(this,e)},F=function e(){Object(b.a)(this,e)};!function(e){e[e.Up=1]="Up",e[e.Down=2]="Down"}(N||(N={}));var D=function(e){Object(M.a)(n,e);var t=Object(T.a)(n);function n(e){var i;return Object(b.a)(this,n),(i=t.call(this)).context=void 0,i.firstTriangleMesh=void 0,i.secondTriangleMesh=void 0,i.startPoint=v.Vector2.Zero(),i.lastEventTimestamp=0,i.context=e,i.firstTriangleMesh=null,i.secondTriangleMesh=null,i}return Object(m.a)(n,[{key:"onDown",value:function(e){var t,n=(null===e||void 0===e||null===(t=e.pickInfo)||void 0===t?void 0:t.hit)&&e.pickInfo.pickedMesh;e.event&&(this.startPoint=new v.Vector2(e.event.x,e.event.y),this.lastEventTimestamp=Date.now()),n&&(this.firstTriangleMesh=this.getTriangleMesh(n))}},{key:"onMove",value:function(e){var t=this,n=this.context.scene.pick(this.context.scene.pointerX,this.context.scene.pointerY);if(n&&1===e.event.buttons){var i=n.pickedMesh;if(!this.firstTriangleMesh&&i&&(this.firstTriangleMesh=this.getTriangleMesh(i),this.startPoint=new v.Vector2(this.context.scene.pointerX,this.context.scene.pointerY),this.lastEventTimestamp=Date.now()),this.firstTriangleMesh){var r=this.firstTriangleMesh.getTriangle();if(Date.now()-this.lastEventTimestamp>300)this.startPoint=new v.Vector2(this.context.scene.pointerX,this.context.scene.pointerY);else{var a=new v.Vector2(this.context.scene.pointerX,this.context.scene.pointerY);if(this.startPoint.subtract(a).length()>40&&i&&i.metadata&&i.metadata.triangle&&i.metadata.triangle.getId()!==r.getId()){var o=this.getTriangleMesh(i);if(o){var s=o.getTriangle().getId();!!this.firstTriangleMesh.getTriangle().getAdjacents().find((function(e){return(null===e||void 0===e?void 0:e.getId())===s}))&&(this.secondTriangleMesh=o)}if(this.secondTriangleMesh){var c=this.secondTriangleMesh.getTriangle();if(r.isAdjacent(c)){var l=!1,u=function(e,n){if(e&&n){var i=e.getTriangle(),r=n.getTriangle(),a=i.getType(),o=r.getType();e.reset(o),n.reset(a),t.context.scene.metadata.icosahedron.notifyTrianglesChanged([i,r])}};this.firstTriangleMesh.flip({triangleMesh:this.secondTriangleMesh,direction:N.Up,onFlipEnd:function(){l&&t.firstTriangleMesh&&t.secondTriangleMesh&&(u(t.firstTriangleMesh,t.secondTriangleMesh),t.context.onFlipEnded()),l=!0}}),this.secondTriangleMesh.flip({triangleMesh:this.firstTriangleMesh,direction:N.Down,onFlipEnd:function(){l&&t.firstTriangleMesh&&t.secondTriangleMesh&&(u(t.firstTriangleMesh,t.secondTriangleMesh),t.context.onFlipEnded()),l=!0}})}}}}}}}},{key:"onRelease",value:function(e){}},{key:"getTriangleMesh",value:function(e){var t=function(e){var t=e.scene,n=e.triangleMesh;if(n&&n.metadata&&n.metadata.triangle){var i=n.metadata.triangle.getName(),r=t.getMeshByName(i);if(r)return r;console.assert("object"===typeof r,"Asset not found")}return null}({scene:this.context.scene,triangleMesh:e});if(t){var n=t.metadata.triangleMesh;if(n){var i=n.computeObjSpaceVertices(),r=n.getScalingRatio(),a=i.map((function(e){return e.scale(r)})),o=n.computeObjSpaceEdges(a);if(a&&o)return n.setVertices(a),n.setEdges(o),n}}return null}}]),n}(F),L=function(e){Object(M.a)(n,e);var t=Object(T.a)(n);function n(e){var i,r=e.thisTriangleMesh,a=e.adjacentTriangleMesh,o=e.scene,s=e.direction,c=e.onFlipEnd;Object(b.a)(this,n),(i=t.call(this)).nextState=null,i.scene=void 0,i.mesh=void 0,i.adjacentMesh=void 0,i.rotation={axis:v.Vector3.Zero(),angle:0},i.flipNode=null,i.scalingNode={node:null,originalPosition:v.Vector3.Zero(),finalPosition:v.Vector3.Zero(),rotationAngle:0},i.skeleton={bones:[],bonesScaling:[],bonesIndices:[],bonesDeformation:[]},i.adjBonesScalingY=[],i.amount=0,i.onFlipEnd=void 0,i.scene=o,i.onFlipEnd=c,i.mesh=r,i.adjacentMesh=a;var l=i.mesh.getAdjacentsVerticesMap(i.adjacentMesh.getTriangle()),u=i.mesh.getTriangleMesh();if(u){i.scalingNode.node=u.parent;var h=l.trAdjs;i.rotation.axis=i.computeRotationAxis(h),i.flipNode=i.computeFlipNodePosition(h);var g=i.computeRotationData(h);if(g){s===N.Down?i.rotation.angle=-g.rotationDownAngle:i.rotation.angle=2*Math.PI-g.rotationDownAngle;var d=g.adjRotationVector.length()/g.rotationVector.length(),f=i.computeCenterShiftVector(l);i.scalingNode.originalPosition=i.scalingNode.node.position.clone(),i.scalingNode.finalPosition=i.scalingNode.originalPosition.scale(d).subtract(f),i.skeleton.bones=u.skeleton&&u.skeleton.bones,i.skeleton.bonesIndices=i.getBonesIndices(h),i.skeleton.bonesScaling=i.getBonesScaling();var p=l.adjTrAdjs;i.adjBonesScalingY=i.computeAdjBonesScalingY(p);var m=[0,1,2].findIndex((function(e){return e!==p[0]&&e!==p[1]})),M=h.findIndex((function(e){return 0===e})),T=-1===M?m:p[M];i.scalingNode.rotationAngle=i.computeNodeRotationAngleToVertex(T),i.skeleton.bonesDeformation=i.computeBonesDeformation(T)}}return i}return Object(m.a)(n,[{key:"computeRotationAxis",value:function(e){var t=this.mesh.getTriangleMeshIndicesSum(e),n=this.mesh.getTriangleMeshFlipEdgeIndex(t);return this.mesh.getEdges()[n]}},{key:"computeFlipNodePosition",value:function(e){if(this.scalingNode.node){var t=this.scalingNode.node.parent,n=this.mesh.getVertices();if(t&&n){var i=v.Vector3.Zero(),r=v.Vector3.Center(n[e[0]],n[e[1]]);return t.setPositionWithLocalVector(r),this.scalingNode.node.position=i.subtract(t.position),t}}return null}},{key:"computeRotationData",value:function(e){var t=this.mesh.getTriangle().getVertices(),n=this.mesh.getTriangleMesh();if(n){var i=this.mesh.computeObjSpaceVertices();if(i){var r=n.computeWorldMatrix(!0),a=v.Vector3.TransformCoordinates(this.adjacentMesh.getTriangle().getCenterPoint(),v.Matrix.Invert(r)),o=this.computeVectorProjectionPoint({vertices:i,index1:e[1],index2:e[0]}),s=this.computeVectorProjectionPoint({vertices:i,center:a,index1:e[0],index2:e[1]}),c=v.Vector3.Zero().subtract(o),l=a.subtract(s),u=v.Vector3.Cross(c,l),h=Math.abs(v.Vector3.GetAngleBetweenVectors(c,l,u)),g=v.Vector3.Center(t[e[0]],t[e[1]]);return{rotationVector:this.mesh.getTriangle().getCenterPoint().subtract(g),adjRotationVector:this.adjacentMesh.getTriangle().getCenterPoint().subtract(g),rotationDownAngle:h}}}return null}},{key:"computeVectorProjectionPoint",value:function(e){var t=e.vertices,n=e.center,i=void 0===n?v.Vector3.Zero():n,r=e.index1,a=e.index2,o=t[r].subtract(t[a]),s=v.Vector3.GetAngleBetweenVectors(i.subtract(t[a]),o,v.Vector3.Cross(i.subtract(t[a]),o)),c=i.subtract(t[a]).length()*Math.cos(s);return t[a].add(o.scale(c/o.length()))}},{key:"computeCenterShiftVector",value:function(e){var t=this.adjacentMesh.getVertices(),n=this.mesh.getVertices(),i=e.trAdjs,r=e.adjTrAdjs;if(t&&n){var a=this.computeVectorProjectionRatio(n,i)-this.computeVectorProjectionRatio(t,r);return n[i[1]].subtract(n[i[0]]).scale(a)}return v.Vector3.Zero()}},{key:"computeVectorProjectionRatio",value:function(e,t){var n=v.Vector3.Zero().subtract(e[t[0]]),i=e[t[1]].subtract(e[t[0]]),r=v.Vector3.Cross(n,i),a=v.Vector3.GetAngleBetweenVectors(n,i,r),o=n.length()*Math.cos(a);return Math.abs(o/i.length())}},{key:"getBonesIndices",value:function(e){var t=this.mesh.getTriangleMeshBonesIndices(e),n=[0,1,2].findIndex((function(e){return e!==t[0]&&e!==t[1]}));return[].concat(Object(P.a)(t),[n])}},{key:"getBonesScaling",value:function(){return this.skeleton.bones?[this.skeleton.bones[this.skeleton.bonesIndices[0]].scaling,this.skeleton.bones[this.skeleton.bonesIndices[1]].scaling,this.skeleton.bones[this.skeleton.bonesIndices[2]].scaling].map((function(e){return e.clone()})):(console.assert(this.skeleton.bones,"Skeleton must exist"),[v.Vector3.One(),v.Vector3.One(),v.Vector3.One()])}},{key:"computeAdjBonesScalingY",value:function(e){var t=[1,1,1],n=this.adjacentMesh.getTriangleMesh();if(n){var i=n.skeleton&&n.skeleton.bones;if(i){var r=this.adjacentMesh.getTriangleMeshBonesIndices(e),a=[0,1,2].findIndex((function(e){return e!==r[0]&&e!==r[1]}));t=[i[r[0]].scaling.y,i[r[1]].scaling.y,i[a].scaling.y]}}return t}},{key:"computeNodeRotationAngleToVertex",value:function(e){var t=this.computeFinPosWorldMatrix(),n=v.Vector3.TransformCoordinates(new v.Vector3(0,0,0),t),i=this.mesh.getVertices();if(i){var r=i.map((function(e){return v.Vector3.TransformCoordinates(e,t)})),a=this.adjacentMesh.getTriangle(),o=a.getCenterPoint(),s=a.getVertices()[e].subtract(o);return v.Vector3.GetAngleBetweenVectors(r[0].subtract(n),s,o)}return 0}},{key:"computeFinPosWorldMatrix",value:function(){var e=this.mesh.getTriangleMesh();if(e&&this.flipNode&&this.scalingNode.node){this.flipNode.rotationQuaternion=v.Quaternion.RotationAxis(this.rotation.axis,this.rotation.angle),this.scalingNode.node.position=this.scalingNode.finalPosition;var t=this.scalingNode.node.parent;t.parent.computeWorldMatrix(!0),t.computeWorldMatrix(!0),this.flipNode.computeWorldMatrix(!0),this.scalingNode.node.computeWorldMatrix(!0);var n=e.computeWorldMatrix(!0);return this.flipNode.rotationQuaternion=v.Quaternion.RotationAxis(this.rotation.axis,0),this.scalingNode.node.position=this.scalingNode.originalPosition,n}return console.assert(e,"Mesh must exist"),v.Matrix.Zero()}},{key:"computeBonesDeformation",value:function(e){var t=this.computeRotatedTriangleVertices(this.adjacentMesh,e),n=this.adjacentMesh.computeBonesRotationAngle({triangle:new I(BigInt(0),t[0],t[1],t[2])}),i=this.mesh.getAngleBonesRotation();return[i[0]+n[1],i[1]+n[0]]}},{key:"computeRotatedTriangleVertices",value:function(e,t){var n=[];switch(t){case 0:n=[0,1,2];break;case 1:n=[1,2,0];break;case 2:n=[2,0,1]}var i=e.getTriangle().getVertices();return n.map((function(e){return i[e]}))}},{key:"update",value:function(){var e=this.getRotationSpeed(),t=this.scene.getEngine().getDeltaTime(),n=this.amount;n<1?(this.setupNodesOnFlipping(n),this.setupBonesOnFlipping(n),this.amount+=e*(t/1e3)):n>=1&&this.completeFlipping();return this.nextState}},{key:"getRotationSpeed",value:function(){return.3*Math.PI*2}},{key:"setupNodesOnFlipping",value:function(e){this.flipNode&&this.scalingNode.node&&(this.flipNode.rotationQuaternion=v.Quaternion.RotationAxis(this.rotation.axis,v.Scalar.LerpAngle(0,this.rotation.angle,e)),this.scalingNode.node.position=v.Vector3.Lerp(this.scalingNode.originalPosition,this.scalingNode.finalPosition,e),this.scalingNode.node.rotation.y=v.Scalar.LerpAngle(0,-this.scalingNode.rotationAngle,e))}},{key:"setupBonesOnFlipping",value:function(e){var t=this,n=this.skeleton,i=n.bones,r=n.bonesDeformation,a=n.bonesScaling,o=this.getRotationSpeed(),s=this.scene.getEngine().getDeltaTime();if(i&&r&&a){i.slice(0,2).forEach((function(e,t){var n=e.rotation;n.y-=v.Scalar.Lerp(0,r[t],o*(s/1e3)),e.setRotation(n)}));var c=a.map((function(n,i){return n&&v.Scalar.Lerp(n.y,t.adjBonesScalingY[i],e)}));c&&this.skeleton.bonesIndices.forEach((function(e,t){i[e].setScale(new v.Vector3(i[e].scaling.x,c[t],i[e].scaling.z))}))}}},{key:"completeFlipping",value:function(){this.nextState=new Z({triangleMesh:this.mesh,scene:this.scene}),this.onFlipEnd&&this.onFlipEnd()}}]),n}(B),z=function(e){Object(M.a)(n,e);var t=Object(T.a)(n);function n(e){var i,r=e.triangleMesh,a=e.scene;return Object(b.a)(this,n),(i=t.call(this)).triangleMesh=void 0,i.nextState=null,i.scene=void 0,i.triangleMesh=r,i.scene=a,i}return Object(m.a)(n,[{key:"update",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return e&&e.adjacentTriangleMesh&&e.direction&&(this.nextState=new L({thisTriangleMesh:this.triangleMesh,adjacentTriangleMesh:e.adjacentTriangleMesh,scene:this.scene,direction:e.direction,onFlipEnd:e.onFlipEnd})),this.nextState}}]),n}(B),Z=z,q=function(){function e(t){var n=t.scene,i=t.triangle,r=t.equilateralTriangleProvider;Object(b.a)(this,e),this.scene=void 0,this.triangle=void 0,this.triangleMesh=void 0,this.triangleEdges=null,this.triangleVertices=null,this.equilateralTriangleRadius=void 0,this.scalingRatio=void 0,this.skeletonBonesScaling=void 0,this.skeletonBonesRotation=void 0,this.bonesRotationAngle=[],this.scalingNodeInitialPosition=v.Vector3.Zero(),this.currentState=void 0,this.currentState=new Z({triangleMesh:this,scene:n}),this.triangle=i,this.triangleMesh=null,this.scene=n;var a=3/Math.sqrt(3)*1,o=r.findEquilateralTriangle(),s=o.p1().subtract(o.p2()).length();this.scalingRatio=1/a*s*.95,this.equilateralTriangleRadius=o.p1().subtract(null===o||void 0===o?void 0:o.getCenterPoint()).length();var c=n.getMeshByName(p);if(c){var l=c.clone(i.getName(),c);if(this.triangleMesh=l,l){l.metadata={triangleMesh:this},this.createNodesStructure(n),this.setupPosition(n,this.scalingRatio),l.skeleton=c&&c.skeleton&&c.skeleton.clone("skeleton".concat(i.getId()));var u=this.computeBonesRotationAngle({triangle:this.triangle});this.setAngleBonesRotation(u);var h=this.computeBonesDeformation(),g=this.computeBonesScaling();this.triangleMesh&&this.triangleMesh.skeleton&&h&&g&&(this.triangleMesh.skeleton.bones.forEach((function(e,t){e.setRotation(h[t]),e.scale(1,g[t],1)})),this.skeletonBonesScaling=this.triangleMesh.skeleton.bones.map((function(e){var t=e.scaling;return new v.Vector3(t.x,t.y,t.z)})),this.skeletonBonesRotation=this.triangleMesh.skeleton.bones.map((function(e){var t=e.rotation;return new v.Vector3(t.x,t.y,t.z)}))),this.setupMaterial()}}}return Object(m.a)(e,[{key:"createNodesStructure",value:function(e){if(this.triangleMesh){var t=e.getNodeByName("root"),n=new v.TransformNode("positionNode".concat(this.triangle.getId()));n.parent=t;var i=new v.TransformNode("rotationNode".concat(this.triangle.getId()));i.parent=n;var r=new v.TransformNode("flipNode".concat(this.triangle.getId()));r.parent=i;var a=new v.TransformNode("scalingNode".concat(this.triangle.getId()));r.rotationQuaternion=v.Quaternion.Identity(),a.parent=r,this.triangleMesh.parent=a,this.scalingNodeInitialPosition=a.position}}},{key:"setupPosition",value:function(e,t){var n=e.getNodeByName("positionNode".concat(this.triangle.getId())),i=e.getNodeByName("rotationNode".concat(this.triangle.getId())),r=e.getNodeByName("scalingNode".concat(this.triangle.getId())),a=this.triangle.getCenterPoint(),o=a,s=A.angle90;if(n&&i&&r&&this.triangleMesh){n.setDirection(o,0,s,0),i.position=new v.Vector3(0,o.length(),0),r.scaling=new v.Vector3(t,t,t);var c=this.triangle.p1().subtract(a),l=v.Vector3.GetAngleBetweenVectors(i.forward,c,i.up);Math.abs(l)>.05&&i.rotate(this.triangleMesh.up,l)}}},{key:"computeBonesRotationAngle",value:function(e){var t=e.triangle,n=t.getCenterPoint(),i=t.p1().subtract(n),r=t.p2().subtract(n),a=t.p3().subtract(n),o=this.scene.getNodeByName("positionNode".concat(this.getTriangle().getId()));if(o){var s=v.Vector3.GetAngleBetweenVectors(i,a,o.up),c=v.Vector3.GetAngleBetweenVectors(i,r,o.up);return[s-A.angle120,c+A.angle120,0]}return[0,0,0]}},{key:"setAngleBonesRotation",value:function(e){this.bonesRotationAngle=e}},{key:"computeBonesDeformation",value:function(){if(console.assert(this.triangleMesh&&this.triangleMesh.skeleton,"Mesh and skeleton must exist"),this.triangleMesh&&this.triangleMesh.skeleton){var e=this.triangleMesh.skeleton,t=e.bones[0].rotation.clone(),n=e.bones[1].rotation.clone(),i=e.bones[2].rotation.clone();return t.y+=this.bonesRotationAngle[0],n.y+=this.bonesRotationAngle[1],[t,n,i]}return[v.Vector3.Zero(),v.Vector3.Zero(),v.Vector3.Zero()]}},{key:"computeBonesScaling",value:function(){var e=this.triangle.getCenterPoint(),t=this.triangle.p1().subtract(e),n=this.triangle.p2().subtract(e),i=this.triangle.p3().subtract(e);return this.triangleMesh&&this.triangleMesh.skeleton&&this.equilateralTriangleRadius?[i.length()/this.equilateralTriangleRadius,n.length()/this.equilateralTriangleRadius,t.length()/this.equilateralTriangleRadius]:[1,1,1]}},{key:"setupMaterial",value:function(){if(this.triangleMesh){var e=new v.StandardMaterial("meshMaterial".concat(this.triangle.getId()),this.scene);e.diffuseColor=this.triangle.getColor(),e.backFaceCulling=!1,e.alpha=1,this.triangleMesh.material=e}}},{key:"getTriangle",value:function(){return this.triangle}},{key:"getTriangleMesh",value:function(){return this.triangleMesh}},{key:"getVertices",value:function(){return this.triangleVertices}},{key:"setVertices",value:function(e){this.triangleVertices=e}},{key:"getEdges",value:function(){return this.triangleEdges}},{key:"setEdges",value:function(e){this.triangleEdges=e}},{key:"getScalingRatio",value:function(){return this.scalingRatio}},{key:"flip",value:function(e){var t={adjacentTriangleMesh:e.triangleMesh,direction:e.direction,onFlipEnd:e.onFlipEnd};this.update(t)}},{key:"update",value:function(e){var t=this.currentState.update(e);t&&(this.currentState=t)}},{key:"computeObjSpaceVertices",value:function(){if(this.triangle&&this.triangleMesh){var e=this.triangle,t=this.triangleMesh.computeWorldMatrix(!0);return[v.Vector3.TransformCoordinates(e.p1(),v.Matrix.Invert(t)),v.Vector3.TransformCoordinates(e.p2(),v.Matrix.Invert(t)),v.Vector3.TransformCoordinates(e.p3(),v.Matrix.Invert(t))]}console.assert(this.triangleMesh&&this.triangle,"Asset not found")}},{key:"computeObjSpaceEdges",value:function(e){return e.map((function(t,n){return t.subtract(e[(n+1)%e.length])}))}},{key:"getAdjacentsVerticesMap",value:function(e){var t=this.triangle.getVertices(),n=e.getVertices(),i={trAdjs:[],adjTrAdjs:[]};return t&&n&&t.forEach((function(e,t){n.forEach((function(n,r){n.subtract(e).length()<y&&(i.trAdjs.push(t),i.adjTrAdjs.push(r))}))})),i}},{key:"getTriangleMeshBonesIndices",value:function(e){var t=[];return e.forEach((function(e,n){switch(e){case 0:t[n]=2;break;case 1:t[n]=1;break;case 2:t[n]=0}})),t}},{key:"getTriangleMeshIndicesSum",value:function(e){return e.reduce((function(e,t){return e+t}))}},{key:"getTriangleMeshFlipEdgeIndex",value:function(e){switch(e){case 1:return 0;case 2:return 2;case 3:return 1}return console.assert(!0,"return value should be a number beetwen 0 and 2"),-1}},{key:"getAngleBonesRotation",value:function(){return this.bonesRotationAngle}},{key:"reset",value:function(e){var t=this,n=this.triangleMesh;n&&n.skeleton&&n.skeleton.bones.forEach((function(e,n){t.skeletonBonesScaling&&e.setScale(t.skeletonBonesScaling[n]),t.skeletonBonesRotation&&e.setRotation(t.skeletonBonesRotation[n])}));var i=null===n||void 0===n?void 0:n.parent,r=i.parent;i.position=this.scalingNodeInitialPosition,i.rotation.y=0,r.position=this.scalingNodeInitialPosition,r.rotationQuaternion=new v.Quaternion(0,0,0,1),this.triangle.setType(e),this.setupMaterial()}}]),e}(),W=n(162),G=function(){function e(){Object(b.a)(this,e),this.version="1.0.0"}return Object(m.a)(e,[{key:"deserialize",value:function(e,t){var n=this,i=JSON.parse(e,(function(e,t){return"jsonSerializerVersion"===e&&console.assert(n.version===t,"Mismatching serializer/deserializer versions"),t})),r=i.triangles.reduce((function(e,t){var n="".concat(t.triangleId);return Object(W.a)(Object(W.a)({},e),{},Object(j.a)({},n,t))}),{}),a=i.triangles.map((function(e){var t=e.triangleId,n=e.vertices,i=e.type,r=new v.Vector3(n[0]._x,n[0]._y,n[0]._z),a=new v.Vector3(n[1]._x,n[1]._y,n[1]._z),o=new v.Vector3(n[2]._x,n[2]._y,n[2]._z);return new I(t,r,a,o,i)})),o=a.reduce((function(e,t){var n="".concat(t.getId());return Object(W.a)(Object(W.a)({},e),{},Object(j.a)({},n,t))}),{});return a.forEach((function(e){var t="".concat(e.getId());return r[t].adjacents.forEach((function(t,n){e.setAdjacent(o["".concat(t.triangleId)],n)})),e})),new S({triangles:a,subdivisionStrategy:t})}}]),e}(),Q=function(e,t){return!!e.find((function(e){return e.getId()===t.getId()}))},Y=function(e,t){return!!e.getVertices().find((function(e){return e.subtract(t).length()<y}))},_=function(e,t){return e.getType()===t.getType()},J=function(e){var t=[];return e.forEach((function(e){[{pivotPoint:e.p1(),adjsPivotPoint:X(e,1)},{pivotPoint:e.p2(),adjsPivotPoint:X(e,2)},{pivotPoint:e.p3(),adjsPivotPoint:X(e,0)}].map((function(t){var n=t.pivotPoint,i=t.adjsPivotPoint;return U(e,n,i)})).filter((function(e){return!!e})).forEach((function(e){return t.push(e)}))})),t},U=function(e,t,n){var i=[e];return n[0]&&n[1]&&_(e,n[0])&&_(e,n[1])&&(i.push(n[0]),i.push(n[1]),n.forEach((function(n){var r=null===n||void 0===n?void 0:n.getAdjacents().find((function(n){return(null===n||void 0===n?void 0:n.getType())===e.getType()&&n.getId()!==e.getId()&&Y(n,t)}));if(r&&(Q(i,r)||i.push(r),n&&Y(r,t))){var a=null===r||void 0===r?void 0:r.getAdjacents().find((function(i){return(null===i||void 0===i?void 0:i.getType())===e.getType()&&i.getId()!==n.getId()&&Y(i,t)}));a&&Y(a,t)&&(Q(i,a)||i.push(a))}}))),6===i.length?i:null},X=function(e,t){return e.getAdjacents().filter((function(e,n){return n!==t}))},H=function(e,t){var n=.5*-Math.PI,i=.4*Math.PI,r=new v.ArcRotateCamera("camera",n,i,3,t,e);return r.minZ=.1,r.lowerRadiusLimit=1.5,r},K=function(e,t){var n=new v.HemisphericLight("light",new v.Vector3(0,1,0),e);n.intensity=1.1,n.setDirectionToTarget(t)},$=function(e){return"Input".concat(e)},ee=function(e,t){var n=[],i=[0,1,2],r=e.getVertices().reduce((function(e,t){return[].concat(Object(P.a)(e),[t.x,t.y,t.z])}),[]),a=new v.VertexData;if(v.VertexData.ComputeNormals(r,i,n),a.positions=r,a.indices=i,a.normals=n,t){var o={points:[e.p1(),e.p1().add(new v.Vector3(n[0],n[1],n[2]))],updatable:!0};v.MeshBuilder.CreateLines("lines",o).color=new v.Color3(1,0,0);var s={points:[e.p2(),e.p2().add(new v.Vector3(n[3],n[4],n[5]))],updatable:!0};v.MeshBuilder.CreateLines("lines",s).color=new v.Color3(1,0,0);var c={points:[e.p3(),e.p3().add(new v.Vector3(n[6],n[7],n[8]))],updatable:!0};v.MeshBuilder.CreateLines("lines",c).color=new v.Color3(1,0,0)}return a},te=function(e,t,n){var i=new v.Mesh(e,t);i.isPickable=!0;var r=new v.StandardMaterial("myMaterial",t),a=255*Math.random();return v.Color3.HSVtoRGBToRef(a,1,1,r.diffuseColor),r.backFaceCulling=!1,r.alpha=0,i.material=r,n.applyToMesh(i,!0),i},ne=function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=new v.TransformNode(e,t);n.forEach((function(e){var n=ee(e,i),a=$(e.getId()),o=te(a,t,n);o.parent=r,o.metadata={triangle:e}}))},ie=function(e,t,n){var i=e.getEngine().getRenderingCanvas();t.attachControl(i,!0),ne("icosahedron",e,n)},re=function(){function e(t,n,i){Object(b.a)(this,e),this.scene=void 0,this.gesturesMap={},this.scene=t,ie(t,n,i)}return Object(m.a)(e,[{key:"onMeshLoaded",value:function(e){var t=this;this.scene.onPointerObservable.add((function(n){var i=n.event.pointerId;switch(n.type){case v.PointerEventTypes.POINTERDOWN:case v.PointerEventTypes.POINTERTAP:var r;if((null===n||void 0===n||null===(r=n.pickInfo)||void 0===r?void 0:r.hit)&&n.pickInfo.pickedMesh){var a={scene:t.scene,triangleMesh:e,onFlipEnded:function(){delete t.gesturesMap[i]}};t.gesturesMap[i]=new D(a),t.gesturesMap[i].onDown(n)}break;case v.PointerEventTypes.POINTERMOVE:var o=t.gesturesMap[i];if(!o){var s={scene:t.scene,triangleMesh:e,onFlipEnded:function(){delete t.gesturesMap[i]}};o=new D(s),t.gesturesMap[i]=o}o.onMove(n);break;case v.PointerEventTypes.POINTERUP:var c=t.gesturesMap[i];c&&c.onRelease(n),delete t.gesturesMap[i]}}))}}]),e}(),ae=function(){var e=function(){var e=Object(f.a)(d.a.mark((function e(){var t,n,i,r;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new E,e.prev=1,e.next=4,fetch("assets/data/icosahedron-3.json").then((function(e){return e.text()}));case 4:if(!(n=e.sent)||!n.length){e.next=9;break}return console.log("Icosahedron JSON file loaded."),i=new G,e.abrupt("return",i.deserialize(n,t));case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),console.log("Icosahedron JSON file was not found.");case 14:return(r=new S({subdivisionStrategy:t})).subdivide(3),e.abrupt("return",r);case 17:case"end":return e.stop()}}),e,null,[[1,11]])})));return function(){return e.apply(this,arguments)}}(),t=function(){var t=Object(f.a)(d.a.mark((function t(n){var i,r,a,o,s,c;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=n,r=new v.Vector3(0,0,0),(a=H(i,r)).inputs.attached.pointers.buttons=[1],t.next=6,e();case 6:(o=t.sent).registerOnTriangleChanged((function(e){var t=J(e);t&&t.forEach((function(e){e&&e.forEach((function(e){var t=i.getMeshByName(e.getName());(t&&t.metadata.triangleMesh).reset(I.getRandomType())}))}))})),s=o.getTriangles(),i.metadata={icosahedron:o},c=new re(i,a,s),K(i,r),v.SceneLoader.ImportMeshAsync(p,"./assets/models/","triangleDebug.babylon").then((function(e){var t=e.meshes,n=e.skeletons;if(t&&t.length>0&&n){var r=t[0],a=s.map((function(e){return new q({scene:i,triangle:e,equilateralTriangleProvider:o})}));r.visibility=0,i.registerBeforeRender((function(){a.forEach((function(e){return e.update()}))})),c.onMeshLoaded(r)}}));case 13:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();return{onRender:function(e){e.getTransformNodeByName("root")},onSceneReady:t}},oe=n(240),se=(n(247),n(129)),ce=["antialias","engineOptions","adaptToDeviceRatio","sceneOptions","onRender","onSceneReady"],le=function(e){var t=Object(o.useRef)(null),n=e.antialias,i=e.engineOptions,r=e.adaptToDeviceRatio,a=e.sceneOptions,s=e.onRender,c=e.onSceneReady,l=Object(oe.a)(e,ce);return Object(o.useEffect)((function(){if(t.current){var e=new v.Engine(t.current,n,i,r),o=new v.Scene(e,a);o.isReady()?c(o):o.onReadyObservable.addOnce((function(e){return c(e)})),e.runRenderLoop((function(){"function"===typeof s&&s(o),o.render()}));var l=function(){o.getEngine().resize()};return window&&window.addEventListener("resize",l),function(){o.getEngine().dispose(),window&&window.removeEventListener("resize",l)}}}),[t]),Object(se.jsx)("canvas",Object(W.a)({ref:t,width:window.innerWidth,height:window.innerHeight},l))},ue=function(){var e=ae(),t=e.onRender,n=e.onSceneReady;return Object(se.jsx)(le,{antialias:!0,onSceneReady:n,onRender:t})},he=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,254)).then((function(t){var n=t.getCLS,i=t.getFID,r=t.getFCP,a=t.getLCP,o=t.getTTFB;n(e),i(e),r(e),a(e),o(e)}))};l.a.render(Object(se.jsx)(s.a.StrictMode,{children:Object(se.jsx)(u.a,{basename:"/xagon-js",children:Object(se.jsx)(h.c,{children:Object(se.jsx)(h.a,{path:"/",element:Object(se.jsx)(ue,{})})})})}),document.getElementById("root")),he()}},[[252,1,2]]]);
//# sourceMappingURL=main.7af328d0.chunk.js.map